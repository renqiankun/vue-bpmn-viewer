(function(r,d){typeof exports=="object"&&typeof module<"u"?module.exports=d(require("inherits"),require("bpmn-js/lib/Viewer"),require("diagram-js/lib/navigation/zoomscroll"),require("diagram-js/lib/navigation/movecanvas"),require("vue")):typeof define=="function"&&define.amd?define(["inherits","bpmn-js/lib/Viewer","diagram-js/lib/navigation/zoomscroll","diagram-js/lib/navigation/movecanvas","vue"],d):(r=typeof globalThis<"u"?globalThis:r||self,r.VueBpmnViewer=d(r.inherits,r.Viewer,r.ZoomScrollModule,r.MoveCanvasModule,r.Vue))})(this,function(r,d,g,b,f){"use strict";const c=e=>e&&typeof e=="object"&&"default"in e?e:{default:e},$=c(r),u=c(d),k=c(g),V=c(b);function m(e){u.default.call(this,e)}$.default(m,u.default),m.prototype._modules=[].concat(u.default.prototype._modules,[k.default,V.default]);const S="",x=(e,t)=>{const i=e.__vccOpts||e;for(const[a,n]of t)i[a]=n;return i},j={name:"vue-bpmn-viewer",data(){return{bpmnModeler:null,overlays:"",canvas:"",flowTypeMap:{comment:"\u5BA1\u6279",rollbackComment:"\u9A73\u56DE"},stateMap:{agree:"AGREE",reject:"REJECT",review:"REVIEW"}}},props:{xml:"",flow:{type:Array,default:()=>[]}},computed:{repainMap(){var{xml:e,flow:t}=this;return{xml:e,flow:t}}},watch:{repainMap:{async handler({xml:e,flow:t}){e&&(await this.$nextTick(),this.preview())},immediate:!0}},methods:{async preview(){var e=this.$refs.viewer;if(!e||!this.xml)return;this.bpmnModeler&&this.bpmnModeler.destroy();var t=this;this.bpmnModeler=new m({container:e,keyboard:{bindTo:t.$el}});var i=await this.bpmnModeler.importXML(this.xml);if(i&&i.error&&i.error.length)return console.error(i);this.bpmnModeler.get("canvas").zoom("fit-viewport","auto"),this.flow&&this.flow.length>0&&this.setMarker()},async setMarker(){await this.$nextTick(),this.canvas=this.bpmnModeler.get("canvas");var e=this.bpmnModeler.get("overlays"),t=this.bpmnModeler.get("elementRegistry"),i={};this.flow.forEach(s=>{var p=s.activityId;i[p]=s});for(var a in i){var n=t.get(a);n&&this.setMarkerHand(n,i[a],e)}},setMarkerHand(e,t,i){var w,_,M,y;var a=e.id,n=(t==null?void 0:t.activityState)||"",s=`<div class='node-tool-tip-reset'>
                      <div>${t.assignGroupName||""}</div>
                      $child$
                 </div>`,p=!1,l=t.activityState?"<p></p>":"";if((w=t.assignDetailList)==null||w.forEach((o,q)=>{o.activityState&&o.activityState!=this.stateMap.review&&(p=!0,l+=`<div> ${o.endTime||o.createTime}</div>`,l+=`<div>${o.assigneeName||""} ${o.activityStateName||""}\uFF1A${o.comment||""}</div>`,l+="<p></p>")}),!p&&t.assignDetailList.length>0&&(l+=`<div> ${(M=(_=t.assignDetailList)==null?void 0:_[0])==null?void 0:M.createTime}</div>`),s=s.replace("$child$",l),i.add(a,{position:{top:e.height+8+(((y=e.label)==null?void 0:y.height)||0),left:e.width/2},html:s}),n==this.stateMap.reject)return this.canvas.addMarker(a,"node-reject");if(n==this.stateMap.agree)return this.canvas.addMarker(a,"node-pass");if(n==this.stateMap.review)return this.canvas.addMarker(a,"node-primary")}}},T={class:"wrap",ref:"viewer"};function E(e,t,i,a,n,s){return f.openBlock(),f.createElementBlock("div",T,null,512)}const v=x(j,[["render",E],["__scopeId","data-v-779b2a4d"]]),h=e=>{e.component(v.name,v)};return v.install=h,window.Vue&&window.Vue.use(h),v});
